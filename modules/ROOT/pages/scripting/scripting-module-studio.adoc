= Use Studio to Configure Scripting Module - Mule 4

Anypoint Studio (Studio) editors help you design and update your Mule applications, properties, and configuration files.

To add and configure the module in Studio:

. <<create-mule-project,Create a Mule project>>.
. <<add-connector-to-project,Add the module to your Mule project>>.
. <<configure-input-source,Configure an input source for the connector's flow>>.
. <<add-connector-operation,Add a connector operation to the flow>>.
. <<configure-global-element,Configure a global element for the connector>>.
. <<conigure-other-fields,Configure the other connector fields>>.


If you are new to configuring connectors in Studio, see xref:introduction/intro-config-use-studio.adoc[Use Studio to Configure a Connector]. If, after reading this topic, you need additional information about the module fields, see the xref:scripting/scripting-reference.adoc[Scripting Module Reference].

[[create-mule-project]]
== Create a Mule Project

In Studio, create a new Mule project in which to add and configure the module:

. In Studio, from the main menu, select *File > New > Mule Project*.
. Enter a name for your Mule project and click *Finish*.


[[add-connector-to-project]]
== Add the Module to Your Mule Project

Add Scripting module to a Mule project to automatically populate the XML code with the module's namespace and schema location, as well as add the required dependencies to the project's `pom.xml` file:

. In the *Mule Palette* view, click *(X) Search in Exchange*.
. In *Add Modules to Project*, type `Scripting Module` in the search field.
. Click *Scripting Module* in *Available modules*.
. Click *Add*.
. Click *Finish*.

Adding a module to a Mule project in Studio does not make that module available to other projects in your Studio workspace.


[[configure-input-source]]
== Configure an Input Source

An input source initiates a flow when a specified condition is met.
You can configure one of these input sources to use with the Scripting Module:

////
If the connector has connector-specific input sources, list them first, using one bullet for each input source.
////

<* connector-specific input source>
* `HTTP Listener`, which initiates a flow each time it receives a request on the configured host and port
* `Scheduler`, which initiates a flow when a time-based condition is met

////
Use one input source as an example. If the connector has a connector-specific input source, use one of those input sources as an example. In the example, list the required and important fields.  If the connector does not have a connector-specific input source, use HTTP Listener, using the text shown below.
////


// Text for using HTTP Listener as an input source

For example, to configure `HTTP Listener`, follow these steps:

. In the *Mule Palette* view, select *HTTP* > *Listener*.
. Drag *Listener* to the Studio canvas.
. On the *Listener* configuration screen, optionally change the value of the *Display Name* field.
. Specify a value for the *Path* field.
. Click the plus sign (+) next to the *Connector configuration* field to configure a global element that can be used by all instances of `HTTP Listener` in the app.
. On the *General* tab, specify connection information.
. On the *TLS* tab, optionally specify TLS information.
. On the *Advanced* tab, optionally specify reconnection information, including a reconnection strategy.
. Click *Test Connection* to confirm that Mule can connect with the specific server.
. Click *OK*.

[[add-connector-operation]]
== Add Execute Operation to the Flow

When you add a module operation to your flow, you immediately define a specific operation for that module to perform.

To add the Execute operation for Scripting Module, follow these steps:

. In the *Mule Palette* view, select *Scripting Module* and then select the desired operation.
. Drag the *Execute* operation onto the Studio canvas to the right of the input source.
. Click the *Execute* operation to open the Execute configuration tab.
. In the *General* tab, provide your script code in the *Code* text box. +
Additionally, you can also load script code in the *Code* text box from an external file by using a xref:mule-runtime::configuring-properties.adoc#_file_properties[File configuration property].
. Select the *Engine* for the execute operation: +

* Groovy
* JRuby (Ruby)
* Jython (Python)
* Nashorn (JavaScript)

.Scripting Module Flow and Execute Configuration Tab with Script Code
image::scripting/scripting-flow.png[Scripting Module Flow and Execute Configuration Tab with Script Code]

In the *Configuration XML* editor, the XML looks similar to the following:

[source,xml,linenums]
----
<scripting:execute engine="jython" doc:name="Script">
    <scripting:code>
      def factorial(n):
          if n == 0: return 1
	  return n * factorial(n-1)

      result = factorial(10)
    </scripting:code>
</scripting:execute>
----

.Script Code with a File Configuration Property
image::scripting/file-config.png[Script Code with a File Configuration Property]

In the *Configuration XML* editor, the XML looks similar to the following:

[source,xml,linenums]
----
<scripting:execute engine="jython" doc:name="Script">
    <scripting:code >${file::script.py}</scripting:code>
</scripting:execute>
----

[[configure-other-fields]]
== Configure Other Module Fields

You can configure other additional fields for the Execute operation.


=== Parameters

[%header,cols="20s,20a,35a,20a,5a"]
|===
| Name | Type | Description | Default Value | Required
| Parameters | Map<String, Object> | Variables provided to the script as bindings | |
|===

In the *General* tab, you can define input *Parameters* values for the script to use through DataWeave. These parameters are a map where keys are strings and values are any object. The DataWeave expression must produce this type of output to work correctly. +
You can use the parameters as binding variables by referencing them by their name, for example: +

`factorial(initialValue + int(payload))`

.Script using parameters
image::scripting/parameters.png[Script using parameters]

In the *Configuration XML* editor, the XML looks something like this:

[source,xml,linenums]
----
<scripting:execute engine="jython" doc:name="Script">
	<scripting:code >def factorial(n):
	if n == 0: return 1
	return n * factorial(n-1)
result = factorial(initialValue + int(payload))</scripting:code>
	<scripting:parameters ><![CDATA[#[{
        initialValue: 10
    }]]]></scripting:parameters>
</scripting:execute>
----

=== Target Variable and Target Value

[%header,cols="20s,20a,35a,20a,5a"]
|===
| Name | Type | Description | Default Value | Required
| Target Variable | String | The name of a variable on which the operation’s output will be placed | |
| Target Value | String | An expression that will be evaluated against the operation’s output and the outcome of that expression will be stored in the target variable | #[payload]|
|===

In the *Advanced* tab, you can define the target value and set a variable as the xref:mule-runtime::target-variables.adoc[target] of the scripting execution.

.Script Target Variable and Target Value
image::scripting/advanced.png[Advanced settings]

In the *Configuration XML* editor, the XML looks similar to the following:

[source,xml,linenums]
----
<scripting:execute engine="jython" doc:name="Script" target="variableName">
    <scripting:code >${file::script.py}</scripting:code>
</scripting:execute>
----

== See Also

* xref:introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* xref:introduction/intro-config-use-studio.adoc[Use Studio to Configure a Connector]
* xref:scripting/scripting-reference.adoc[Scripting Module Reference]
* https://help.mulesoft.com[MuleSoft Help Center]
